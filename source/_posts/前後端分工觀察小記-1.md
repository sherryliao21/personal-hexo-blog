---
title: 前後端分工觀察小記-1
date: 2022-02-28 15:40:11
tags:
  - work-related
---
<p align="left">
  <img src="https://superface.ai/blog/images/posts/2021-openapi-apis.jpg" alt="invitation" style="margin: 20px; height: 300px; width: 600px"/>
</p>


# 前言
學生時期做過前後端協作的專案，但因缺乏討論，後端寫 API 時前端還在切元件，因此等到要串接時，只能對後端寫的回傳格式照單全收，又或者修修改改，要後端配合前端渲染方便所需的格式，組出奇怪的資料結構，並沒有一個討論出一個格式或職責分工的標準。後端工程師工作至今快半年，這陣子透過實際解決客戶需求、和前端工程師合作開發，以及接受技術主管的任務分派，也體驗到實務上的情境與對應的做法確實與學生時期大大不同，以此篇紀錄這陣子協作的心得與疑問。

# 情境
由於公司產品（ioT）近期正經歷調整的階段，慢慢轉為多個微服務的架構，因此我也獲得自己 own 一個 service 的學習機會，在從零打造 service API 到與前端工程師協作、到 review 產品功能定義到與 UI/UX 設計師討論的過程中，也經歷了不少「協調」與「配合」。
<!-- more -->

這次的 service 其中有一支 API 為歷史線圖的呈現，前端必須向後端要求資料，透過 chart library 來呈現。而因為內部 DB 並不會儲存產線機台停機時間的資料，造成資料不連續，若直接將這樣的資料撈出吐回去給前端的話，對於使用者而言，將會很難看出「停機時間的變化」且不直覺。因此，由於前端使用的 chart library 的限制，我們需要對撈出來的資料做處理，補上 timestamp 與 null 值來製造圖表上的斷層。

## 問題1：前端補？還是後端補？
「如果在前端補的話太吃效能，使用者體驗不好」
「但後端應該要忠實回覆來自 DB 的資料，在後端對資料做太多加工真的好嗎？」
「這是為了前端 library 的格式而補，因此它和 UI 相關，應該要前端補才對？」
「前端要補的話還需要時間等參數，還需要後端再回一次，太麻煩
「有多支 API 需要這樣的邏輯，那是否寫在後端共用更好？」

## 問題2：後端來的資料應該是原汁原味，還是可為了前端 library 進行資料再加工？
目前有幾個線圖所需呈現的資料都是需要經過「再加工」的。例如將不同機台收集的數據根據分類，進行加總、平均等等，而這些計算的目的都是為了「前端 UI 的呈現」，那麼是否應該在前端做處理呢？

所謂後端原汁原味的資料，可以接受加工最大的幅度應該是：在 DB 下 query 時，取某區段時間內值之 avg，或取得某區間的 max - min 等等，這樣原始、「包含商業邏輯但不包含 UI 考量」的數據。

## 問題3：前後端格式與易維護性？
由於前端 code base 並無拆分 service，大部分元件仍沿用前人的寫法，因此就算架構並不彈性、格式雜亂，在有限的時間下難以進行重構，仍需沿用前人的架構來撰寫。剛好後端分 micro service 帶來了重構的契機，可以在 API 回傳值中做出架構更乾淨、更好維護的資料格式，此時與前端元件原本定義需要的資料格式便有了衝突。

在產品、code base 迭代的過程中，究竟要使用「方便前端渲染」的格式，還是「方便後端擴充維護」、「盡量呈現 DB 原始資料格式」的格式呢？

# 釐清需求與職責
最後我們決定的方式是依照前後端的「需求」，來評估資料的處理、格式的整理，究竟該如何分工。

## UI 考量（使用者想看的東西） ---> 前端來做


## 商業邏輯（產品想呈現的東西） ---> 後端來做


# 大家都怎麼做？
前後端如何分工沒有標準答案，或許不同團隊有不同的作法，每個團隊對於 MVC 架構的認知與考量不同，不能一言以蔽之。因此，雖然我能透過與前端工程師的來回討論與磨合，互相妥協約定能夠加速開發、好維護的格式，我仍想要知道在其他地方，前後端工程師都是怎麼協調的，這也帶出了一個問題：商業邏輯應該放在前端還是後端？

以下是 google 到的相關討論：

